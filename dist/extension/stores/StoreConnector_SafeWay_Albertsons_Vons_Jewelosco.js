 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>l});var __awaiter=function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r.throw(e))}catch(e){i(e)}}function step(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:i,UIHelpers:s,Cookies:c,Settings:a,AjaxMethod:u,Logger:p,$:d}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new n(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5f55d4d1e8adfb0011038094","5f55d4f0bf8efc00117e89fe","5f55d505bf8efc00117e8a00","5f55d52ce8adfb0011038097"]},pageSelector:"#applyPromo",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:1e5,getCartTotal:1e5,beforeApplyingCoupon:5e3,applyCoupon:1e5,afterApplyingCoupon:1e4}},this.functions={token:"",currentData:null,shopStoreId:"",preference:"",get subscriptionKey(){return"0550188475574504983fa3949e886cd7"},get storeName(){let e="";return location.href.replace(/www.([^.]+).com/,(t,o)=>(e=o,"")),e},getTotalPrice(){return __awaiter(this,void 0,void 0,(function*(){if(!this.token){const e=yield i.ajax("GET",location.origin+"/bin/safeway/unified/userinfo?banner="+this.storeName),t=JSON.parse(e.response);this.token=t.SWY_SHOP_TOKEN,this.shopStoreId=t.shopStoreId,this.preference=t.preference}const e=window.location.search,t=new URLSearchParams(e);t.get("storeId")&&(this.shopStoreId=t.get("storeId"));const o=yield i.ajax("GET",location.origin+"/abs/pub/xapi/erums/checkoutservice/api/v1/checkout?storeId="+this.shopStoreId+"&fulfillmentType="+this.preference,!0,{headers:{adrum:"isAjax:true","ocp-apim-subscription-key":this.subscriptionKey,"ocp-apim-trace":!0,authorization:"Bearer "+this.token}});this.currentData=o.response;return this.currentData.orderSummary.totalEstimatedPrice}))}},this.context={}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){if(null===this.functions.currentData&&(yield this.functions.getTotalPrice()),this.functions.currentData.orderSummary.promotions.length){const e=this.functions.currentData.orderSummary.promotions[0].code,t=this.functions.currentData.storeId,o=this.functions.currentData.serviceType,r=this.functions.currentData.cartId;yield i.ajax("DELETE",location.origin+"/abs/pub/xapi/erums/checkoutservice/api/v1/checkout/promotion/"+r+"/"+e+"/?storeId="+t+"&fulfillmentType="+o,!1,{headers:{"ocp-apim-subscription-key":this.functions.subscriptionKey,authorization:"Bearer "+this.functions.token}})}return[]}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){return yield this.functions.getTotalPrice()}))}beforeApplyingCoupon(){}applyCoupon(e){return __awaiter(this,void 0,void 0,(function*(){yield this.collectAndClearAppliedCoupons();const t=this.functions.currentData.storeId,o=this.functions.currentData.serviceType,r=this.functions.currentData.cartId,n=this.functions.currentData.slots.reservedSlot.slotId;yield i.ajax("POST",location.origin+"/abs/pub/xapi/erums/checkoutservice/api/v1/checkout/promotion?storeId="+t+"&fulfillmentType="+o,!0,{data:JSON.stringify({cartId:r,promotions:[e],slotId:n}),headers:{authorization:"Bearer "+this.functions.token,"ocp-apim-subscription-key":this.functions.subscriptionKey}});return{cartTotalAfterApply:yield this.functions.getTotalPrice()}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),p.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const l=window.Fatcoupon.StoreConnector})();