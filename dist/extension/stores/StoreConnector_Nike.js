 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>u});var __awaiter=function(e,t,o,r){return new(o||(o=Promise))((function(a,n){function fulfilled(e){try{step(r.next(e))}catch(e){n(e)}}function rejected(e){try{step(r.throw(e))}catch(e){n(e)}}function step(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:a,Helpers:n,UIHelpers:i,Cookies:l,Settings:p,AjaxMethod:d,Logger:c,$:s}=window.Fatcoupon.ModulesImporter;class StoreConnector_Nike_Cart extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5e72d1f12b5d0300113183ae"]},reloadPageAfterApplying:!0,pageSelector:"[data-automation='cart-summary'] [data-automation='summary-promo-code']",cartTotalSelector:"[data-automation='summary-total'] > .price",pageName:"cart",timeouts:{collectAndClearAppliedCoupons:15e3,getCartTotal:1e4,beforeApplyingCoupon:1e4,applyCoupon:1e4,afterApplyingCoupon:15e3},codeInputSelector:"[name='promotionCode']",applyCouponSuccessSelector:"[data-automation='promo-code-line-item']",applyCouponErrorSelector:"[data-automation-id='error-close'], [data-automation='summary-promo-code'] form > div:nth(1)",appliedCouponsSelector:"[data-automation='promo-code-line-item']",appliedCouponRemoveBtnSelector:"~ div > i",errorPopupCloseBtnSelector:"[data-automation-id='error-close']",showCodeInputBtnSelector:"[data-automation='summary-promo-code'] > div > a",applyCodeBtnBtnSelector:"[data-automation=promo-code-apply-button]"},this.functions={getAppliedCouponText:e=>e.innerText.split(" - ")[0],closeErrorPopup:()=>__awaiter(this,void 0,void 0,(function*(){let e=s(this.metadata.errorPopupCloseBtnSelector);e.length&&(yield i.simulateClick(e),yield n.waitForDisappear(this.metadata.errorPopupCloseBtnSelector))}))},this.context={}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let e=[],t=s(this.metadata.appliedCouponsSelector);for(let o of t)e.push(this.functions.getAppliedCouponText(o)),yield i.simulateClick(s(o).find(this.metadata.appliedCouponRemoveBtnSelector)),yield Promise.race([n.waitForDisappear(o),n.wait(3e3).then(()=>this.collectAndClearAppliedCoupons())]);return yield n.wait(1e3),e}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){return yield n.wait(500),r.getCartTotalBySelector(this.metadata.cartTotalSelector)}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){s(this.metadata.codeInputSelector).length&&(yield i.simulateClick(s(this.metadata.showCodeInputBtnSelector)),yield n.waitForDisappear(this.metadata.codeInputSelector)),s(this.metadata.codeInputSelector).length||(yield i.simulateClick(s(this.metadata.showCodeInputBtnSelector)),yield n.waitFor(this.metadata.codeInputSelector))}))}applyCoupon(e){return __awaiter(this,void 0,void 0,(function*(){yield this.functions.closeErrorPopup();let t=s(this.metadata.codeInputSelector);yield i.clearInput(t),yield n.wait(100),yield i.sendKeysTogether(e+"{enter}",t,!0),yield n.wait(100);let o=s(this.metadata.applyCodeBtnBtnSelector);return o.length&&(o.hasClass("disabled")&&o.removeClass("disabled"),o.attr("disabled")&&o.prop("disabled",null),yield i.simulateClick(o)),yield Promise.race([n.waitFor(this.metadata.applyCouponSuccessSelector).then(()=>!0),n.waitFor("[name=promotionCode][aria-invalid=true]").then(()=>!1),n.wait(4e3).then(()=>!1)]),{cartTotalAfterApply:yield this.getCartTotal()}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){yield this.functions.closeErrorPopup(),yield this.collectAndClearAppliedCoupons()}))}}window.Fatcoupon.StoreConnector=new a(new StoreConnector_Nike_Cart(!1),new class extends StoreConnector_Nike_Cart{constructor(){super(...arguments),this.metadata={reloadPageAfterApplying:!1,storeIds:{dev:["5e71a2d5143a6a7208500264"],prod:["5e72d1f12b5d0300113183ae"]},pageSelector:"#checkout-wrapper #payment #prepaidCard",cartTotalSelector:".priceTotal",pageName:"checkout",timeouts:{collectAndClearAppliedCoupons:15e3,getCartTotal:1e4,beforeApplyingCoupon:1e4,applyCoupon:1e4,afterApplyingCoupon:15e3},codeInputSelector:"#promoCode:visible",applyCouponSuccessSelector:".test-promotions",applyCouponErrorSelector:"[data-automation-id='error-close'], .prepaid-promo-list > .js-error:parent, #promoCode[aria-invalid='true']",appliedCouponsSelector:".list-of-gc > .gift-card",appliedCouponRemoveBtnSelector:".custom-x-button",errorPopupCloseBtnSelector:".modal-container .error-code-btn",showCodeInputBtnSelector:"#prepaidCard",applyCodeBtnBtnSelector:"button.qa-promocode"},this.functions={getAppliedCouponText:e=>"",closeErrorPopup:()=>__awaiter(this,void 0,void 0,(function*(){let e=s(this.metadata.errorPopupCloseBtnSelector);e.length>0&&(yield i.simulateClick(e),yield n.waitForDisappear(this.metadata.errorPopupCloseBtnSelector),yield n.wait(100))}))}}}(!1)),c.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const u=window.Fatcoupon.StoreConnector})();