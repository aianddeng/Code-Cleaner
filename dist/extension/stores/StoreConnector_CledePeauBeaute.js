 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{default:()=>d});var __awaiter=function(t,o,e,r){return new(e||(e=Promise))((function(n,c){function fulfilled(t){try{step(r.next(t))}catch(t){c(t)}}function rejected(t){try{step(r.throw(t))}catch(t){c(t)}}function step(t){var o;t.done?n(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(fulfilled,rejected)}step((r=r.apply(t,o||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:e,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:c,UIHelpers:a,Cookies:i,Settings:l,AjaxMethod:p,Logger:s,$:u}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new n(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5f0530dff7b6cd001109849d"]},pageSelector:".cart-coupon-code",cartTotalSelector:".cart-order-totals .order-value.total-bold",codeInputSelector:".cart-coupon-field ",codeApplySelector:"#add-coupon",codeApplyErrorSelector:"#promocode-error",codeRemoveSelector:'.rowcoupons button[value="Remove"]',reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:3e4,getCartTotal:3e4,beforeApplyingCoupon:5e3,applyCoupon:3e4,afterApplyingCoupon:3e4}},this.functions={getToken:()=>{let t=u('.cart-coupon-code input[name="csrf_token"]');if(0===t.length)throw Error("ERROR: getToken not found");return t.attr("value")},getTotalAndUpdateCoupons:t=>{let o=null,e=t.split("var basketConfirmation = ")[1].trim();return e.length>0&&(o=JSON.parse(e.split(";\nvar isSPCEnable = true;")[0].trim())),this.context.coupons=o.coupons,o.gross},getFormAction:t=>0===t.length?{}:{action:t.attr("action")||"bad-action",method:t.attr("method")||"bad-method"}},this.context={isCheckoutsPage:!1,coupons:null,total:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let t=[];const o=u("#spcCheckoutSteps");this.context.isCheckoutsPage=!!o.length;let e=this.context.coupons||u(".cartcoupon .value");if(0===e.length)return t;if(!this.context.isCheckoutsPage){const t=u("form#cart-items-form"),{method:o,action:r}=this.functions.getFormAction(t),n=c.getAllFormData(t);let a;delete n.dwfrm_cart_isGift,n.dwfrm_cart_coupons_i0_deleteCoupon="Remove",n.dwfrm_cart_updateCart="dwfrm_cart_updateCart",n.dwfrm_cart_couponCode="",n.csrf_token=this.functions.getToken();for(let t of e){let t=yield c.ajax("POST",r,!1,{headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","cache-control":"max-age=0","content-type":"application/x-www-form-urlencoded","upgrade-insecure-requests":"1"},data:n});const{error:o,response:e}=t;if(o)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${o}`);a=e}let i=this.functions.getTotalAndUpdateCoupons(a);console.log(i,"delete"),this.context.total=i}return t}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){if(this.context.isCheckoutsPage){let t=yield c.ajax("GET",""+location.href,!1),{error:o,response:e}=t;if(o)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${o}`);let r=this.functions.getTotalAndUpdateCoupons(e);return console.log(r,"get"),r}{if(this.context.total)return this.context.total;let t=yield c.ajax("GET",""+location.href,!1),{error:o,response:e}=t;if(o)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${o}`);let r=this.functions.getTotalAndUpdateCoupons(e);return console.log(r,"get"),r}}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){let o,e;if(this.context.isCheckoutsPage){const r=u("form.coupon-submit-form"),{method:n,action:a}=this.functions.getFormAction(r),i=this.functions.getToken();e=yield c.ajax("POST",a,!1,{headers:{accept:"*/*","content-type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{dwfrm_cart_couponCode:t,csrf_token:i}});const{error:l,response:p}=e;if(l)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${l}`);o=yield this.getCartTotal(),console.log(o,"after")}else{const r=u("form#cart-items-form"),{method:n,action:a}=this.functions.getFormAction(r),i=c.getAllFormData(r);i.dwfrm_cart_updateCart="dwfrm_cart_updateCart",i.dwfrm_cart_couponCode=t,i.dwfrm_cart_addCoupon="dwfrm_cart_addCoupon",i.csrf_token=this.functions.getToken(),e=yield c.ajax("POST",a,!1,{headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","cache-control":"max-age=0","content-type":"application/x-www-form-urlencoded","upgrade-insecure-requests":"1"},data:i});const{error:l,response:p}=e;if(l)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${l}`);o=this.functions.getTotalAndUpdateCoupons(p),console.log(o,"after"),this.context.total=o}return{cartTotalAfterApply:o}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){yield this.collectAndClearAppliedCoupons()}))}}(!1)),s.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const d=window.Fatcoupon.StoreConnector})();