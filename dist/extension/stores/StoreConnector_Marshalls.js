 /**************************
 * Time: 30.12.20 09:38:42 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(function(t){var e={};function __webpack_require__(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,o){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(__webpack_require__.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(o,r,(function(e){return t[e]}).bind(null,r));return o},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="chrome-extension://nefpialbilfbjkjcgmgbpmnhlikdoana/stores/",__webpack_require__(__webpack_require__.s="./src/coupon-applying/stores/StoreConnector_Marshalls.ts")})({"./src/coupon-applying/stores/StoreConnector_Marshalls.ts":function(t,e,o){"use strict";o.r(e);var __awaiter=function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:r,StoreConnectorHelpers:n,MultipageStoreConnectorWrapper:i,Helpers:c,UIHelpers:a,Cookies:s,Settings:l,AjaxMethod:u,Logger:p,$:d}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new i(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5e91401fdfc61600114f4d87"]},pageSelector:"#promo-code",cartTotalSelector:location.host.startsWith("m")?".order-details .total-amount":".order-total-price",removeSelector:location.host.startsWith("m")?".remove.promo-remove":".cart-promos-list .removeCouponFromCart, .checkout-promos-list .removeCoupon",reloadPageAfterApplying:!location.search.includes("couponRemoveForm"),redirectToPageAfterApplying:location.origin+location.pathname,timeouts:{collectAndClearAppliedCoupons:15e3,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:15e3,afterApplyingCoupon:1e4}},this.functions={getCartPage:()=>__awaiter(this,void 0,void 0,(function*(){const{error:t,response:e}=yield c.ajax("GET",`/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/cart.jsp`);if(t)throw Error("ERROR: "+JSON.stringify(t));this.context.cartTotal=c.parseUsdString(d(this.metadata.cartTotalSelector,e).text()),this.context.html=e})),sendRequest:(t="")=>__awaiter(this,void 0,void 0,(function*(){const e=c.getAllFormData(d(this.metadata.pageSelector,this.context.html||document).closest("form"));e["/atg/commerce/promotion/CouponFormHandler.couponClaimCode"]=t,e["promo-code"]=t,e._DARGS=`/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/views/cart.jsp.promo`;const{error:o,response:r}=yield c.ajax("POST",`/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/cart.jsp?_DARGS=/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/views/cart.jsp.promo`,!1,{data:e});if(o)throw Error("ERROR: "+JSON.stringify(o));return t&&r?c.parseUsdString(d(this.metadata.cartTotalSelector,r).text()):0})),removeCode:(t="")=>__awaiter(this,void 0,void 0,(function*(){const{error:e,response:o}=yield c.ajax("GET",`/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/cart.jsp`);if(e)throw Error("ERROR: "+JSON.stringify(e));const r=c.getAllFormData(this.context.mobile?d("[id^=removeCoupon]",o):d("#couponRemoveForm",o));this.context.mobile?r["/atg/commerce/promotion/CouponFormHandler.unClaimCouponOverride"]=t:(r["/atg/commerce/promotion/CouponFormHandler.couponClaimCode"]="",r["/atg/commerce/promotion/CouponFormHandler.unClaimCoupon"]=t);const{error:n,response:i}=yield c.ajax("POST",`/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/cart.jsp?_DARGS=/${this.context.usePlace?"us/":""}${this.context.mobile?"m":"store"}/checkout/views/cart.jsp.${this.context.mobile?"removeCoupon"+t:"couponRemoveForm"}`,!1,{data:r});if(n)throw Error("ERROR: "+JSON.stringify(n));return t&&i&&(this.context.cartTotal=c.parseUsdString(d(this.metadata.cartTotalSelector,i).text())),0}))},this.context={cartTotal:0,cartTotalAfterApply:0,html:null,mobile:location.host.startsWith("m"),usePlace:location.host.includes("marshalls")}}collectAndClearAppliedCoupons(){var t,e;return __awaiter(this,void 0,void 0,(function*(){const o=[];this.context.cartTotal=0,this.context.cartTotalAfterApply=0,yield this.functions.getCartPage();for(const r of d(this.metadata.removeSelector)){const n=(null===(t=d(r).attr("couponid"))||void 0===t?void 0:t.trim())||(null===(e=d(r).attr("data-formid"))||void 0===e?void 0:e.split("removeCoupon").pop().trim());o.includes(n)||(o.push(n),yield this.functions.removeCode(n))}return o}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const t=this.context.cartTotalAfterApply||this.context.cartTotal;return p.log("getCartTotal: "+t)(),t}))}beforeApplyingCoupon(){}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){return this.context.cartTotalAfterApply=yield this.functions.sendRequest(t),{cartTotalAfterApply:this.context.cartTotalAfterApply}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),p.borderedMessage("FatCoupon: store connector injected!","#a3cc91"),e.default=window.Fatcoupon.StoreConnector}});