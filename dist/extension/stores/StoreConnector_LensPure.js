 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>u});var __awaiter=function(t,e,o,r){return new(o||(o=Promise))((function(n,a){function fulfilled(t){try{step(r.next(t))}catch(t){a(t)}}function rejected(t){try{step(r.throw(t))}catch(t){a(t)}}function step(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:a,UIHelpers:i,Cookies:s,Settings:c,AjaxMethod:d,Logger:l,$:p}=window.Fatcoupon.ModulesImporter;class StoreConnector_LensPure extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5ef16d7df627230011e687e3"]},pageSelector:"#post-track-a-package .shopping_cart",cartTotalSelector:"tr.order-total span",redirectToPageAfterApplying:`https://${location.host}/order/confirm/setPaymentPoint/1/changeAddress/1/`,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:5e3}},this.functions={getAllFormData(t){var e={},o={};return t.find("input,select,textarea").each((function(t){o[t]=p(this)})),p.each(o,(function(){var o,r,n=p(this);if("submit"==n.attr("type")||"button"==n.attr("type"))return!0;if(void 0!==n.attr("name")&&""!=n.attr("name")?o=n.attr("name").trim():void 0!==n.attr("id")&&""!=n.attr("id")?o=n.attr("id").trim():void 0!==n.attr("class")&&""!=n.attr("class")&&(o=n.attr("class").trim()),void 0!==n.val()?r="checkbox"==n.attr("type")?n.parent().find('input[name="'+o+'"]:checked').val():"radio"==n.attr("type")?p('input[name="'+o+'"]:checked',t).val():n.val():null!=n.text()&&(r=n.text()),void 0===r&&(r=""),void 0!==o){var a=new Array;-1!==o.indexOf(" ")?a=o.split(/(\s+)/):a.push(o),p.each(a,(function(t,o){""!=(o=o.trim())&&(e[o]=r)}))}})),e},goBackRequest:()=>__awaiter(this,void 0,void 0,(function*(){let t=yield a.ajax("GET",`https://${location.host}/order/delivery/setPaymentPoint/1/changeAddress/1/`,!1);if(t.error)throw Error(`ERROR: ${this.constructor.name}.applyCoupon() | go back request error | ${t.error}`);return t}))},this.context={}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let t=yield this.functions.goBackRequest(),e=this.functions.getAllFormData(p(t.response).find("#customer_details > form"));e.couponCode="",e.Continue="Continue";let o=p(t.response).find("#customer_details > form").attr("action"),r=yield a.ajax("POST",o,!1,{data:e});if(r.error)throw Error(`ERROR: ${this.constructor.name}.applyCoupon() | clear coupon request error | ${r.error}`);return[]}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){return yield r.getCartTotalBySelectorLoadPage(this.metadata.cartTotalSelector)}))}beforeApplyingCoupon(){}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){let e=yield this.functions.goBackRequest(),o=this.functions.getAllFormData(p(e.response).find("#customer_details > form"));o.couponCode=t,o.Continue="Continue";let r=p(e.response).find("#customer_details > form").attr("action"),n=yield a.ajax("POST",r,!1,{data:o});if(n.error)throw Error(`ERROR: ${this.constructor.name}.applyCoupon() | apply coupon request error | ${n.error}`);return{cartTotalAfterApply:yield this.getCartTotal()}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}window.Fatcoupon.StoreConnector=new n(new StoreConnector_LensPure(!1),new class extends StoreConnector_LensPure{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5ef16d7df627230011e687e3"]},pageSelector:"#couponCode",cartTotalSelector:"tr.order-total span",redirectToPageAfterApplying:`https://${location.host}/order/confirm/setPaymentPoint/1/changeAddress/1/`,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:5e3}}}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const{error:t,response:e}=yield a.ajax("GET",`https://${location.host}/order/confirm/setPaymentPoint/1/changeAddress/1/`);if(t)throw Error("ERROR: "+JSON.stringify(t));if(e)return a.parseUsdString(p(e).find(this.metadata.cartTotalSelector).first().text())}))}}(!1)),l.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const u=window.Fatcoupon.StoreConnector})();