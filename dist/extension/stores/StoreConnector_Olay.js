 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{default:()=>u});var __awaiter=function(t,o,e,r){return new(e||(e=Promise))((function(n,a){function fulfilled(t){try{step(r.next(t))}catch(t){a(t)}}function rejected(t){try{step(r.throw(t))}catch(t){a(t)}}function step(t){var o;t.done?n(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(fulfilled,rejected)}step((r=r.apply(t,o||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:e,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:a,UIHelpers:c,Cookies:l,Settings:i,AjaxMethod:s,Logger:p,$:d}=window.Fatcoupon.ModulesImporter;class StoreConnector_Class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5f1f82448eff6f562eb39af5"],prod:["5f0530dff7b6cd00110984a4"]},pageSelector:"#couponcode,.coupon-remove",cartTotalSelector:".cart-total-value.cart-total-grandTotal",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:1e4}},this.functions={},this.context={total:0,cartTotalAfterApply:0,token:""}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){const t=[];try{this.context.token=d("head").html().match(/"csrf_token":"(.*?)"/)[1],this.context.total=+d("body").html().match(/"subtotal": "(.*?)"/)[1]}catch(t){}const o=d("input.coupon-code").val();if(o){t.push(o);const e=new URL(`${location.origin}${d(".coupon-remove a").attr("href")}`),r=yield a.ajax("GET",e.href);if(r.error)throw Error("ERROR: "+JSON.stringify(r.error));if(r.response)try{this.context.total=+r.response.match(/"subtotal": "(.*?)"/)[1]}catch(t){}}return t}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){let t=0;return this.context.total?(t=this.context.total,this.context.total=0):this.context.cartTotalAfterApply?(t=this.context.cartTotalAfterApply,this.context.cartTotalAfterApply=0):t=yield r.getCartTotalBySelectorLoadPage(this.metadata.cartTotalSelector),console.log(t),t}))}beforeApplyingCoupon(){}applyCoupon(t){var o,e;return __awaiter(this,void 0,void 0,(function*(){let r=0;const n=new URL(location.origin+"/remote/v1/apply-code"),c=yield a.ajax("POST",n.href,!1,{data:{code:t},headers:{"x-xsrf-token":`${this.context.token}, ${this.context.token}`}});if(c.error)throw Error("ERROR: "+JSON.stringify(c.error));if(c.response&&"success"===(null===(e=null===(o=c.response)||void 0===o?void 0:o.data)||void 0===e?void 0:e.status)){const t=(yield a.ajax("GET","https://www.olay.com/cart.php",!1)).response;try{return r=+t.match(/"order_total" : "(.*?)"/)[1],this.context.cartTotalAfterApply=r,{cartTotalAfterApply:r}}catch(t){}}return{discount:0}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}window.Fatcoupon.StoreConnector=new n(new StoreConnector_Class(!1),new class extends StoreConnector_Class{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5f1f82448eff6f562eb39af5"],prod:["5f0530dff7b6cd00110984a4"]},pageSelector:"#checkout-app",cartTotalSelector:"._1K7MmQgoXFr7eVZKQ2ttjB",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:1e4}}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){const t=[];try{this.context.token=d("head").html().match(/"csrf_token":"(.*?)"/)[1],this.context.total=+d("body").html().match(/"subtotal": "(.*?)"/)[1]}catch(t){}const o=(yield a.ajax("GET","https://www.olay.com/cart.php",!1)).response,e=d(o).find("input.coupon-code").val();if(e){t.push(e);const r=new URL(`${location.origin}${d(o).find(".coupon-remove a").attr("href")}`),n=yield a.ajax("GET",r.href);if(n.error)throw Error("ERROR: "+JSON.stringify(n.error));if(n.response)try{this.context.total=+n.response.match(/"subtotal": "(.*?)"/)[1]}catch(t){}}return t}))}}(!1)),p.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const u=window.Fatcoupon.StoreConnector})();