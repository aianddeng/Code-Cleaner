 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>d});var __awaiter=function(t,e,o,a){return new(o||(o=Promise))((function(r,n){function fulfilled(t){try{step(a.next(t))}catch(t){n(t)}}function rejected(t){try{step(a.throw(t))}catch(t){n(t)}}function step(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(fulfilled,rejected)}step((a=a.apply(t,e||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,MultipageStoreConnectorWrapper:a,Helpers:r,UIHelpers:n,Settings:i,Logger:l,StoreConnectorHelpers:c,$:p}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new a(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5e96bc97b7b1722193daabf1"],prod:["5e913d62dfc61600114f4d83"]},pageSelector:"#promoInput",cartTotalSelector:"[data-at=order_total],[data-at=bsk_total_cc]",reloadPageAfterApplying:!1,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:15e3,afterApplyingCoupon:5e3}},this.functions={getBasketData:()=>__awaiter(this,void 0,void 0,(function*(){let{error:t,response:e}=yield r.ajax("GET",`https://${location.host}/api/shopping-cart/basket`,!1);if(t)throw Error(`ERROR: ${this.constructor.name}.getCartTotal() | get Basket request error | ${t}`);return e}))},this.context={cartTotal:null,cartTotalAfterApply:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){window.setInterval(()=>{p("[data-at=modal_close]").length&&n.simulateClick(p("[data-at=modal_close]"))},200);let t=p("[data-at*=applied_promo]+button");for(const e of t)yield n.simulateClick(p(e)),yield r.waitForDisappear(e);return this.context.cartTotalAfterApply=0,this.context.cartTotal=yield c.getCartTotalBySelector(this.metadata.cartTotalSelector),[]}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const t=this.context.cartTotalAfterApply||this.context.cartTotal;return l.log("getCartTotal: "+t)(),t}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){if("FatCoupon"===t){const t=[];if(t.push(yield c.getCartTotalBySelector(this.metadata.cartTotalSelector),this.context.cartTotal-p("[data-at=promo_info]").text().split("$").filter(Boolean).map(r.parseUsdString).reduce((t,e)=>t+e)),this.context.cartTotalAfterApply=Math.min(...t),this.context.cartTotal===this.context.cartTotalAfterApply){const t=p("[data-at=promo_info]").text();t.includes("$")?this.context.cartTotalAfterApply-=r.parseUsdString(t):t.includes("Free standard shipping")?this.context.cartTotalAfterApply-=0:this.context.cartTotalAfterApply-=.01}return{cartTotalAfterApply:this.context.cartTotalAfterApply}}let e=p("#promoInput");return yield n.clearInput(e),yield r.wait(100),yield n.sendKeysTogether(t+"{enter}",e,!0),yield r.wait(100),yield n.simulateClick(p("button[data-at^='apply_btn']")),yield Promise.race([r.waitFor("[data-at=applied_promo]").then(()=>!0),r.waitFor("[data-at=modal_dialog]").then(()=>!0),r.waitFor("[data-comp*=InputMsg]").then(()=>!1),r.wait(6e3).then(()=>!1)]),{discount:0}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){p("[data-at=promo_item_add_button]").length&&(n.simulateClick(p("[data-at=promo_item_add_button]")),yield r.wait(250),p("[data-at=done_button]").length&&n.simulateClick(p("[data-at=done_button]")))}))}}(!1)),l.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const d=window.Fatcoupon.StoreConnector})();