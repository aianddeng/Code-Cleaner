 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var e={d:(o,t)=>{for(var r in t)e.o(t,r)&&!e.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{default:()=>p});var __awaiter=function(e,o,t,r){return new(t||(t=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r.throw(e))}catch(e){i(e)}}function step(e){var o;e.done?n(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(fulfilled,rejected)}step((r=r.apply(e,o||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:t,MultipageStoreConnectorWrapper:r,Helpers:n,Cookies:i,Logger:a,UIHelpers:c,$:s}=window.Fatcoupon.ModulesImporter;class StoreConnector_Sears extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5e9547017ca6ad1558d57312"],prod:["5e913ccedfc61600114f4d82"]},pageSelector:"input#focusPromoInput",cartTotalSelector:".order-subtotal .right",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:15e3,getCartTotal:15e3,beforeApplyingCoupon:15e3,applyCoupon:15e3,afterApplyingCoupon:15e3}},this.apis={viewData:`${location.origin}/crsp/api/cart/v1/summary/view?ts=${(new Date).getTime()}`,addCoupon:`${location.origin}/crsp/api/cart/v1/coupon/add?ts=${(new Date).getTime()}`,removeCoupon:`${location.origin}/crsp/api/cart/v1/coupon/remove?ts=${(new Date).getTime()}`,headers:{spc:i.readDocumentCookie("spcTarget")}},this.functions={getSummaryData:()=>__awaiter(this,void 0,void 0,(function*(){return(yield n.ajax("GET",this.apis.viewData,!0,{headers:this.apis.headers})).response.response.ordSummary}))},this.context={total:null,serviceMap:null,code:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let e=[];try{const{couponSavings:o}=yield this.functions.getSummaryData();if(!o||0===o.length)return e;for(const t in o){e.push(o[t].promoTitle);let r=yield n.ajax("POST",this.apis.removeCoupon,!0,{headers:this.apis.headers,data:JSON.stringify({couponRequest:{couponCode:o[t].promoTitle}})});if("0000"!=r.response.response.responseCode)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon clear request error | ${r.error}`)}}catch(e){a.log("collectAndClearAppliedCoupons--error",e)()}return e}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const{merchTotal:e}=yield this.functions.getSummaryData();return n.parseUsdString(e)}))}beforeApplyingCoupon(){}applyCoupon(e){return __awaiter(this,void 0,void 0,(function*(){this.context.code=e;try{let o=yield n.ajax("POST",this.apis.addCoupon,!0,{headers:this.apis.headers,data:JSON.stringify({couponRequest:{couponCode:e}})});a.log("applyCouponResponse",o)(),yield n.wait(100);const{merchTotal:t}=yield this.functions.getSummaryData();let r=n.parseUsdString(t);return a.log("t",r)(),{cartTotalAfterApply:r}}catch(e){return{discount:0}}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}window.Fatcoupon.StoreConnector=new r(new StoreConnector_Sears(!1),new class extends StoreConnector_Sears{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5e9547017ca6ad1558d57312"],prod:["5e913ccedfc61600114f4d82"]},pageSelector:"input#promo",cartTotalSelector:".order-subtotal .right",reloadPageAfterApplying:!1,timeouts:{collectAndClearAppliedCoupons:15e3,getCartTotal:15e3,beforeApplyingCoupon:15e3,applyCoupon:15e3,afterApplyingCoupon:15e3}},this.apis={viewData:location.origin+"/ccil/api/cart/v1/summary/view",addCoupon:location.origin+"/ccil/api/cart/v1/coupon/add",removeCoupon:location.origin+"/ccil/api/cart/v1/coupon/remove",headers:{authorization:"SEARSMWEB"}}}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const{merchTotal:e}=yield this.functions.getSummaryData();if(this.context.code){const e=s("#promo");yield c.clearInput(e),yield n.wait(100),yield c.sendKeysTogether(this.context.code+"{enter}",e,!0),yield n.wait(100),yield c.simulateClick(s('[ng-click="promoSectionCtrl.applyPromo(code)"]')),this.context.code=null}return n.parseUsdString(e)}))}}(!1)),a.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const p=window.Fatcoupon.StoreConnector})();