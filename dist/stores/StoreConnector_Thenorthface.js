 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>d});var __awaiter=function(t,e,o,r){return new(o||(o=Promise))((function(n,a){function fulfilled(t){try{step(r.next(t))}catch(t){a(t)}}function rejected(t){try{step(r.throw(t))}catch(t){a(t)}}function step(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:a,UIHelpers:c,Cookies:i,Settings:s,AjaxMethod:l,Logger:p,$:u}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new n(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5e913b04dfc61600114f4d7f"]},pageSelector:"#PromotionCodeForm",cartTotalSelector:"#amount-after-giftcards-apply-summary",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:5e3}},this.functions={getApplyAction:()=>{const t=u("#PromotionCodeForm").attr("action");if(!t)throw Error("ERROR: action not found");return t},getRemoveAction:()=>{const t=u("form[name='promotionCodeForm']").attr("action");if(!t)throw Error("ERROR: action not found");return t},getOrderCalculate:(t="")=>__awaiter(this,void 0,void 0,(function*(){let e=u(".checkout-summary-recalculate").serializeArray();e.promoCode=t,e.requesttype="ajax";let o=yield a.ajax("POST",`https://${location.host}/webapp/wcs/stores/servlet/${u("form[name='reCalculateOrderForm']").attr("action")}`,!1,{data:e});if(o.error)throw Error(`ERROR: ${this.constructor.name}.getOrderCalculate() | cannot fetch basket data | ${o.error}`);return a.parseUsdString(o.response.amounts.grandTotalWithGiftCard)}))},this.context={}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let t=[],e=u(".applied-promo .checkout-gift-card-num").text();if(!e)return t;t.push(e);const o=a.getAllFormData(u("form[name='promotionCodeForm']"));return o.promoCode=e,o.requesttype="ajax",(yield a.ajax("POST",`https://${location.host}/webapp/wcs/stores/servlet/${this.functions.getRemoveAction()}`,!1,{data:o,contentType:"application/x-www-form-urlencoded"}))&&(yield this.functions.getOrderCalculate()),t}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const t=a.getAllFormData(u("form[name='refreshTotalForm']"));t.requesttype="ajax";let e=yield a.ajax("GET",`https://${location.host}/webapp/wcs/stores/servlet/${u("form[name='refreshTotalForm']").attr("action")}`,!1,{data:t});if(console.log("getCartPageRequest from server shown by Frank--\x3e",e),e.error)throw Error(`ERROR: ${this.constructor.name}.getCartTotal() | cannot fetch basket data | ${e.error}`);let o=u(e.response).find(this.metadata.cartTotalSelector);if(0===o.length)throw Error(`ERROR: ${this.constructor.name}.getCartTotal() | cart total element not found on cart page`);return a.parseUsdString(o.text())}))}beforeApplyingCoupon(){}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){const e=a.getAllFormData(u("#PromotionCodeForm"));e.promoCode=t,e.requesttype="ajax";let o=yield a.ajax("POST",`https://${location.host}/webapp/wcs/stores/servlet/${this.functions.getApplyAction()}`,!1,{data:e,contentType:"application/x-www-form-urlencoded"});if(o.error)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon reset request error | ${o.error}`);if(o.response.errorCode)return{discount:0};{const e=yield this.functions.getOrderCalculate(t);return e?{cartTotalAfterApply:e}:{discount:0}}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),p.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const d=window.Fatcoupon.StoreConnector})();