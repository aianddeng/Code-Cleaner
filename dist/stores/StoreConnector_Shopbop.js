 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{default:()=>u});var __awaiter=function(t,o,e,r){return new(e||(e=Promise))((function(n,a){function fulfilled(t){try{step(r.next(t))}catch(t){a(t)}}function rejected(t){try{step(r.throw(t))}catch(t){a(t)}}function step(t){var o;t.done?n(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(fulfilled,rejected)}step((r=r.apply(t,o||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:e,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:a,UIHelpers:i,Cookies:c,Settings:l,AjaxMethod:s,Logger:d,$:p}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new n(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5f0530dff7b6cd00110984a8"]},pageSelector:"#promoCodeAction",cartTotalSelector:"#subTotal .toggleOff",codeInputSelector:"#promotionCode",codeApplySelector:"#addPromotion",codeRemoveSelector:"#removePromotion",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:3e4,getCartTotal:3e4,beforeApplyingCoupon:5e3,applyCoupon:3e4,afterApplyingCoupon:3e4}},this.functions={getCodeRemoveForm:()=>{let t=p(this.metadata.codeRemoveSelector);return 0===t.length?null:p(t).closest("form")},getCodeApplyForm:()=>{let t=p(this.metadata.codeApplySelector);if(0===t.length)throw Error("ERROR: getCodeApplyForm not found");return p(t).closest("form")},getFormAction:t=>0===t.length?{}:{action:t.attr("action")||"bad-action",method:t.attr("method")||"bad-method"}},this.context={}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let t=[];const o=this.functions.getCodeRemoveForm();if(!o)return t;const{action:e,method:r}=this.functions.getFormAction(o),n=a.getAllFormData(o);n.promotionCode="";let i=yield a.ajax("POST",e,!1,{data:n}),{error:c,response:l}=i;if(c)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${c}`);return t}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){let t=yield a.ajax("GET",""+location.href,!1),{error:o,response:e}=t;if(o)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${o}`);let r=+a.parseUsdString(p(e).find(this.metadata.cartTotalSelector).text());return console.log(r,"get"),r}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){let o,e;const r=p("#promoCodeAction"),{method:n,action:i}=this.functions.getFormAction(r),c=a.getAllFormData(r);c.promotionCode=t,e=yield a.ajax("POST",i,!1,{data:c});const{error:l,response:s}=e;if(l)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${l}`);return o=+a.parseUsdString(p(s).find(this.metadata.cartTotalSelector).text()),console.log(o,"after"),{cartTotalAfterApply:o}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1),new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5f0530dff7b6cd00110984a8"]},pageSelector:'div[data-at="MobilePromoDisplay"], a[data-at="removePromoCode"]',cartTotalSelector:'span[data-at="subtotal"]',codeInputSelector:'input[data-at="PromotionInput"]',codeApplySelector:'button[data-at="MobilePromotionApplyButton"]',codeRemoveSelector:'a[data-at="removePromoCode"]',reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:3e4,getCartTotal:3e4,beforeApplyingCoupon:5e3,applyCoupon:3e4,afterApplyingCoupon:3e4}},this.functions={getCartId:()=>(this.context.cartId||(this.context.cartId=p('div[data-at="ShoppingCart"]').attr("data-cart-id")),this.context.cartId),getSiteId:()=>(this.context.siteId||(this.context.siteId=p("#site-id").attr("data-site-id")),this.context.siteId),getCsrfToken:()=>(this.context.csrfToken||(this.context.csrfToken=p("#csrfToken").attr("data-csrf-token")),this.context.csrfToken)},this.context={cartId:null,siteId:null,csrfToken:null,total:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let t=[];if(!p(this.metadata.codeRemoveSelector).length)return t;let o=this.functions.getSiteId(),e=this.functions.getCartId(),r=this.functions.getCsrfToken(),{error:n,response:i}=yield a.ajax("POST",`https://api.shopbop.com/carts/${e}?siteId=${o}&lang=en-US&currency=USD`,!0,{headers:{"csrf-token":r},data:JSON.stringify({promotionCode:""})});return this.context.total=a.parseUsdString(i.total),console.log(this.context.total,"after delete"),t}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){if(this.context.total)return this.context.total;let t=yield r.getCartTotalBySelector(this.metadata.cartTotalSelector);return console.log(t,"get"),t}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(t){return __awaiter(this,void 0,void 0,(function*(){let o=this.functions.getSiteId(),e=this.functions.getCartId(),r=this.functions.getCsrfToken(),n=yield a.ajax("POST",`https://api.shopbop.com/carts/${e}?siteId=${o}&lang=en-US&currency=USD`,!0,{headers:{"csrf-token":r},data:JSON.stringify({promotionCode:t})});const{error:i,response:c}=n;if(i)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${i}`);return this.context.total=a.parseUsdString(c.total),console.log(this.context.total,"after delete"),{cartTotalAfterApply:this.context.total}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),d.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const u=window.Fatcoupon.StoreConnector})();