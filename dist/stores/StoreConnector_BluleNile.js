 /**************************
 * Time: 19.10.20 10:27:53 *
 * Host: yuangongdeMBP     *
 * User: chase             *
 **************************/

(function(e){var t={};function __webpack_require__(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,o){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(__webpack_require__.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(o,r,(function(t){return e[t]}).bind(null,r));return o},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="chrome-extension://nefpialbilfbjkjcgmgbpmnhlikdoana/stores/",__webpack_require__(__webpack_require__.s="./src/coupon-applying/stores/StoreConnector_BluleNile.ts")})({"./src/coupon-applying/stores/StoreConnector_BluleNile.ts":function(e,t,o){"use strict";o.r(t);var __awaiter=function(e,t,o,r){return new(o||(o=Promise))((function(n,a){function fulfilled(e){try{step(r.next(e))}catch(e){a(e)}}function rejected(e){try{step(r.throw(e))}catch(e){a(e)}}function step(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:r,StoreConnectorHelpers:n,MultipageStoreConnectorWrapper:a,Helpers:c,UIHelpers:u,Cookies:i,Settings:l,AjaxMethod:p,Logger:s,$:d}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new a(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{prod:["5f5ed05b73d88f001163d391"]},pageSelector:"#purchase-details-order-total",cartTotalSelector:"#purchase-details-order-total",codeRemoveSelector:".promo-code b",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:14e3,getCartTotal:1e4,beforeApplyingCoupon:5e3,applyCoupon:14e3,afterApplyingCoupon:14e3}},this.functions={},this.context={total:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let e=[];if(!d(this.metadata.codeRemoveSelector).length)return e;let{countryCode:t,languageCode:o,productSet:r,currencyCode:n}=JSON.parse(d("body").attr("data-userstate")),{error:a,response:u}=yield c.ajax("DELETE",`https://${location.host}/api/secure/basket/source-code?country=${t}&language=${o}&productSet=${r}&currency=${n}`,!1,{headers:{accept:"*/*","x-bn-pageid":"Basket"}});return this.context.total=c.parseUsdString(u.orderInfo.orderTotal),console.log(this.context.total,"after delete"),e}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){return this.context.total||(this.context.total=yield n.getCartTotalBySelector(this.metadata.cartTotalSelector),console.log(this.context.total,"get")),this.context.total}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(e){return __awaiter(this,void 0,void 0,(function*(){let{countryCode:t,languageCode:o,productSet:r,currencyCode:n}=JSON.parse(d("body").attr("data-userstate")),a=c.getAllFormData(d("#pf-form"));a.sourceCode=e;let{error:u,response:i}=yield c.ajax("POST",`https://${location.host}/api/secure/basket/source-code?country=${t}&language=${o}&productSet=${r}&currency=${n}`,!1,{headers:{accept:"*/*","content-type":"application/x-www-form-urlencoded; charset=UTF-8","x-bn-pageid":"Basket"},data:a});if(u)throw Error(`ERROR: ${this.constructor.name}.collectAndClearAppliedCoupons() | coupon apply request error | ${u}`);return this.context.total=c.parseUsdString(i.orderInfo.orderTotal),console.log(this.context.total,"after delete"),{cartTotalAfterApply:this.context.total}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),s.borderedMessage("FatCoupon: store connector injected!","#a3cc91"),t.default=window.Fatcoupon.StoreConnector}});