 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var t={d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{default:()=>p});var __awaiter=function(t,o,e,n){return new(e||(e=Promise))((function(r,i){function fulfilled(t){try{step(n.next(t))}catch(t){i(t)}}function rejected(t){try{step(n.throw(t))}catch(t){i(t)}}function step(t){var o;t.done?r(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(fulfilled,rejected)}step((n=n.apply(t,o||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:e,StoreConnectorHelpers:n,MultipageStoreConnectorWrapper:r,Helpers:i,UIHelpers:c,Cookies:a,Settings:l,AjaxMethod:s,Logger:u,$:d}=window.Fatcoupon.ModulesImporter;window.Fatcoupon.StoreConnector=new r(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:["5eccab42cc183a3b724893f2"],prod:["5ea0083fc571ab001124bf5e"]},pageSelector:".checkout.pgOrderReview,.checkout.pgPayOptions .giftPromo>*",cartTotalSelector:".orderTotal  strong, .total .amount",reloadPageAfterApplying:!0,timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:1e4,beforeApplyingCoupon:1e4,applyCoupon:1e4,afterApplyingCoupon:1e4}},this.functions={getToken:()=>__awaiter(this,void 0,void 0,(function*(){const t=yield i.runCodeAtPageContext("\n                    callback(window.tokenGenerator.get());\n                ");if(u.log(t)(),!t)throw Error("ERROR: scrf not found");return t})),getInfo:()=>__awaiter(this,void 0,void 0,(function*(){const t=yield i.runCodeAtPageContext("\n                    callback(window.cartVars);\n                ");if(u.log(t)(),!t)throw Error("ERROR: values not found");return t}))},this.context={total:null,oldCode:null,oldAmount:null,cartTotal:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){return[]}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){if(this.context.total)return this.context.total;let{cart:{cartId:t,cartTotal:o,cartVouchers:e},versionId:n}=yield this.functions.getInfo();return(null==e?void 0:e.length)&&(this.context.oldCode=e[0].name,this.context.oldAmount=e[0].amount,o+=e[0].amount),this.context.cartTotal=o,u.log(o)(),o}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}applyCoupon(t){var o,e;return __awaiter(this,void 0,void 0,(function*(){const{cart:{cartId:n,cartTotal:r},versionId:c}=yield this.functions.getInfo(),l=yield this.functions.getToken();a.setDocumentCookie("csrfToken",l);let s=yield i.ajax("POST",`https://${location.host}/api/sales/presentation/v1/us/carts/${n}/vouchers`,!0,{data:JSON.stringify({code:t}),headers:{accept:"*/*","x-csrf-token":l,"if-match":c,"x-application-code":"QVC","x-application-version":"1.0","x-user-agent-text":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36 Edg/87.0.664.75"}}),{error:u,response:d}=s,p=0;if(20005==(null===(e=null===(o=null==u?void 0:u.jqXHR)||void 0===o?void 0:o.responseJSON)||void 0===e?void 0:e.code)&&(this.context.total=this.context.cartTotal-this.context.oldAmount,p=this.context.oldAmount),null==d?void 0:d.amount)try{const{amount:t}=d;this.context.total=t>0?r-t:r,p=t}catch(t){}return{discount:p}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1)),u.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const p=window.Fatcoupon.StoreConnector})();