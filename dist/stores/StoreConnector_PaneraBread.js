 /**************************
 * Time: 07.04.21 13:35:56 *
 * Host: iMac-P            *
 * User: undefined         *
 **************************/

(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>u});var __awaiter=function(e,t,o,r){return new(o||(o=Promise))((function(n,a){function fulfilled(e){try{step(r.next(e))}catch(e){a(e)}}function rejected(e){try{step(r.throw(e))}catch(e){a(e)}}function step(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};if(!window.Fatcoupon||!window.Fatcoupon.ModulesImporter)throw Error("window.Fatcoupon.ModulesImporter not set, store connector injection failed");const{StoreConnector,StoreConnectorFunctionResult:o,StoreConnectorHelpers:r,MultipageStoreConnectorWrapper:n,Helpers:a,UIHelpers:l,Cookies:c,Settings:i,AjaxMethod:s,Logger:p,$:d}=window.Fatcoupon.ModulesImporter;class StoreConnector_Class_Old extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5f3cadbfffa5a2001158ea13"]},pageSelector:"#promoCode[ng-model]:visible",cartTotalSelector:"form[name='balance'] .form-group:last-child label:last-of-type",codeInputSelector:"#promoCode",applyCouponSuccessSelector:"div[ng-repeat='discount in cost.discount']",applyCouponErrorSelector:".alert.alert-danger span",showCodeInputBtnSelector:"li:nth-child(2) button[ng-click='$ctrl.selectPane(pane)']",applyCodeBtnBtnSelector:"form[ng-submit='applyDiscount()'] .form-group.schema-form-submit > input[value='Apply']",appliedCouponRemoveBtnSelector:"[ng-click='removeDiscount(discount)']",timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:1e4,beforeApplyingCoupon:5e3,applyCoupon:1e4,afterApplyingCoupon:1e4}},this.functions={getAppliedCouponText:e=>e.innerText},this.context={total:null}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){let e=[];return 0===d(this.metadata.applyCouponSuccessSelector).length||(yield l.simulateClick(d(this.metadata.appliedCouponRemoveBtnSelector)),yield Promise.all([a.waitForDisappear(this.metadata.applyCouponSuccessSelector),a.wait(4*i.COUPON_APPLYING.DELAY_INSIDE_ACTION)])),e}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){let e=yield r.getCartTotalBySelector(this.metadata.cartTotalSelector);return console.log(e,"get"),e}))}beforeApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){d(this.metadata.codeInputSelector).is(":visible")||(yield l.simulateClick(d(this.metadata.showCodeInputBtnSelector)),yield Promise.all([a.waitForFilter(()=>d(this.metadata.codeInputSelector).is(":visible")),a.wait(2*i.COUPON_APPLYING.DELAY_INSIDE_ACTION)])),yield l.clearInput(this.metadata.codeInputSelector)}))}applyCoupon(e){return __awaiter(this,void 0,void 0,(function*(){let t=d(this.metadata.codeInputSelector);t.focus(),yield l.sendKeysTogether(e+"{enter}",t,!1),yield a.wait(2*i.COUPON_APPLYING.DELAY_INSIDE_ACTION);let o=d(this.metadata.applyCodeBtnBtnSelector);if(yield l.simulateClick(o),yield Promise.race([a.waitFor(this.metadata.applyCouponSuccessSelector).then(()=>!0),a.waitFor(this.metadata.applyCouponErrorSelector).then(()=>!1)])){let e=yield this.getCartTotal();return console.log(e,"after"),{cartTotalAfterApply:e}}return{discount:0}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){yield this.collectAndClearAppliedCoupons()}))}}window.Fatcoupon.StoreConnector=new n(new class extends StoreConnector{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5f3cadbfffa5a2001158ea13"]},pageSelector:"[class*=promo-code]",cartTotalSelector:".text-right [class*=total-text]",reloadPageAfterApplying:!1,redirectToPageAfterApplying:location.origin+"/en-us/app/checkout.html",timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:5e3,beforeApplyingCoupon:5e3,applyCoupon:5e3,afterApplyingCoupon:1e4}},this.functions={},this.context={cartTotal:0,cartTotalAfterApply:0}}collectAndClearAppliedCoupons(){return __awaiter(this,void 0,void 0,(function*(){const e=[];this.context.cartTotal=0,this.context.cartTotalAfterApply=0;const t=JSON.parse(sessionStorage.vuex).cart.cartObject.discounts;if(!t||!t.length)return e;const o=new URL("https://www-api.panerabread.com/www-api/public/cart/discounts/remove?refreshItems=true"),{error:r,response:n}=yield a.ajax("POST",o.href,!0,{data:JSON.stringify({cartId:JSON.parse(sessionStorage.vuex).cart.cartObject.cartId,discountCode:t[0].promoCode}),headers:{"x-session-trace-id":JSON.parse(sessionStorage.vuex).user.traceId}});return n&&(this.context.cartTotal=n.cartSummary.totalPrice),e}))}getCartTotal(){return __awaiter(this,void 0,void 0,(function*(){const e=this.context.cartTotalAfterApply||this.context.cartTotal;return p.log("getCartTotal: "+e)(),e}))}beforeApplyingCoupon(){}applyCoupon(e){var t;return __awaiter(this,void 0,void 0,(function*(){const o=new URL("https://www-api.panerabread.com/www-api/public/cart/discounts?refreshItems=true"),{error:r,response:n}=yield a.ajax("POST",o.href,!0,{data:JSON.stringify({cartId:JSON.parse(sessionStorage.vuex).cart.cartObject.cartId,discounts:[{promoCode:e,type:"SPECIAL_CODE"}]}),headers:{"x-session-trace-id":JSON.parse(sessionStorage.vuex).user.traceId}});return(null===(t=null==n?void 0:n.discounts)||void 0===t?void 0:t.length)?(this.context.cartTotalAfterApply=this.context.cartTotal-n.discounts[0].amount,{cartTotalAfterApply:this.context.cartTotalAfterApply||this.context.cartTotal}):{discount:0}}))}afterApplyingCoupon(){return __awaiter(this,void 0,void 0,(function*(){}))}}(!1),new StoreConnector_Class_Old(!1),new class extends StoreConnector_Class_Old{constructor(){super(...arguments),this.metadata={storeIds:{dev:[""],prod:["5f3cadbfffa5a2001158ea13"]},pageSelector:'[ng-switch="$ctrl.selectedPane"]:visible',cartTotalSelector:"form[name='balance'] .form-group:last-child label:last-of-type",codeInputSelector:'[ng-switch="$ctrl.selectedPane"] #promoCode',applyCouponSuccessSelector:"div[ng-repeat='discount in cost.discount']",applyCouponErrorSelector:".alert.alert-danger span",showCodeInputBtnSelector:"li:nth-child(2) button[ng-click='$ctrl.selectPane(pane)']",applyCodeBtnBtnSelector:"form[ng-submit='applyDiscount()'] .form-group.schema-form-submit > input[value='Apply']",appliedCouponRemoveBtnSelector:"[ng-click='removeDiscount(discount)']",timeouts:{collectAndClearAppliedCoupons:1e4,getCartTotal:1e4,beforeApplyingCoupon:5e3,applyCoupon:1e4,afterApplyingCoupon:1e4}}}}(!1)),p.borderedMessage("FatCoupon: store connector injected!","#a3cc91");const u=window.Fatcoupon.StoreConnector})();